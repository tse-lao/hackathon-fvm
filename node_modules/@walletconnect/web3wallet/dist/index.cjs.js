"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var A=require("@walletconnect/auth-client"),I=require("@walletconnect/sign-client"),l={exports:{}},u=typeof Reflect=="object"?Reflect:null,m=u&&typeof u.apply=="function"?u.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},f;u&&typeof u.ownKeys=="function"?f=u.ownKeys:Object.getOwnPropertySymbols?f=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:f=function(t){return Object.getOwnPropertyNames(t)};function N(s){console&&console.warn&&console.warn(s)}var y=Number.isNaN||function(t){return t!==t};function o(){o.init.call(this)}l.exports=o,l.exports.once=M,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var w=10;function g(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(s){if(typeof s!="number"||s<0||y(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");w=s}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||y(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function L(s){return s._maxListeners===void 0?o.defaultMaxListeners:s._maxListeners}o.prototype.getMaxListeners=function(){return L(this)},o.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var h=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw h.context=r,h}var c=a[t];if(c===void 0)return!1;if(typeof c=="function")m(c,this,e);else for(var v=c.length,x=O(c,v),n=0;n<v;++n)m(x[n],this,e);return!0};function _(s,t,e,n){var i,a,r;if(g(e),a=s._events,a===void 0?(a=s._events=Object.create(null),s._eventsCount=0):(a.newListener!==void 0&&(s.emit("newListener",t,e.listener?e.listener:e),a=s._events),r=a[t]),r===void 0)r=a[t]=e,++s._eventsCount;else if(typeof r=="function"?r=a[t]=n?[e,r]:[r,e]:n?r.unshift(e):r.push(e),i=L(s),i>0&&r.length>i&&!r.warned){r.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=s,h.type=t,h.count=r.length,N(h)}return s}o.prototype.addListener=function(t,e){return _(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return _(this,t,e,!0)};function q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(s,t,e){var n={fired:!1,wrapFn:void 0,target:s,type:t,listener:e},i=q.bind(n);return i.listener=e,n.wrapFn=i,i}o.prototype.once=function(t,e){return g(e),this.on(t,E(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return g(e),this.prependListener(t,E(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,i,a,r,h;if(g(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(a=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){h=n[r].listener,a=r;break}if(a<0)return this;a===0?n.shift():W(n,a),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,h||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var a=Object.keys(n),r;for(i=0;i<a.length;++i)r=a[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function C(s,t,e){var n=s._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?j(i):O(i,i.length)}o.prototype.listeners=function(t){return C(this,t,!0)},o.prototype.rawListeners=function(t){return C(this,t,!1)},o.listenerCount=function(s,t){return typeof s.listenerCount=="function"?s.listenerCount(t):S.call(s,t)},o.prototype.listenerCount=S;function S(s){var t=this._events;if(t!==void 0){var e=t[s];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function O(s,t){for(var e=new Array(t),n=0;n<t;++n)e[n]=s[n];return e}function W(s,t){for(;t+1<s.length;t++)s[t]=s[t+1];s.pop()}function j(s){for(var t=new Array(s.length),e=0;e<t.length;++e)t[e]=s[e].listener||s[e];return t}function M(s,t){return new Promise(function(e,n){function i(r){s.removeListener(t,a),n(r)}function a(){typeof s.removeListener=="function"&&s.removeListener("error",i),e([].slice.call(arguments))}R(s,t,a,{once:!0}),t!=="error"&&F(s,i,{once:!0})})}function F(s,t,e){typeof s.on=="function"&&R(s,"error",t,e)}function R(s,t,e,n){if(typeof s.on=="function")n.once?s.once(t,e):s.on(t,e);else if(typeof s.addEventListener=="function")s.addEventListener(t,function i(a){n.once&&s.removeEventListener(t,i),e(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}const b="wc",z=2,p="Web3Wallet",X=`${b}@${2}:${p}:`,K={database:":memory:"},k="request";class G extends l.exports{constructor(){super()}}class P{constructor(t){this.opts=t}}class T{constructor(t){this.client=t}}class U extends T{constructor(t){super(t),this.init=async()=>{this.signClient=await I.SignClient.init({core:this.client.core,metadata:this.client.metadata}),this.authClient=await A.AuthClient.init({core:this.client.core,projectId:"",metadata:this.client.metadata}),this.initializeEventListeners()},this.pair=async e=>{await this.client.core.pairing.pair(e)},this.approveSession=async e=>{const{topic:n,acknowledged:i}=await this.signClient.approve({id:e.id,namespaces:e.namespaces});return await i(),this.signClient.session.get(n)},this.rejectSession=async e=>await this.signClient.reject(e),this.updateSession=async e=>await(await this.signClient.update(e)).acknowledged(),this.extendSession=async e=>await(await this.signClient.extend(e)).acknowledged(),this.respondSessionRequest=async e=>await this.signClient.respond(e),this.disconnectSession=async e=>await this.signClient.disconnect(e),this.emitSessionEvent=async e=>await this.signClient.emit(e),this.getActiveSessions=()=>this.signClient.session.getAll().reduce((e,n)=>(e[n.topic]=n,e),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.respondAuthRequest=async(e,n)=>await this.authClient.respond(e,n),this.getPendingAuthRequests=()=>this.authClient.requests.getAll().filter(e=>"requester"in e),this.formatMessage=(e,n)=>this.authClient.formatMessage(e,n),this.onSessionRequest=e=>{this.client.events.emit("session_request",e)},this.onSessionProposal=e=>{this.client.events.emit("session_proposal",e)},this.onSessionDelete=e=>{this.client.events.emit("session_delete",e)},this.onAuthRequest=e=>{this.client.events.emit("auth_request",e)},this.initializeEventListeners=()=>{this.signClient.events.on("session_proposal",this.onSessionProposal),this.signClient.events.on("session_request",this.onSessionRequest),this.signClient.events.on("session_delete",this.onSessionDelete),this.authClient.on("auth_request",this.onAuthRequest)},this.signClient={},this.authClient={}}}class d extends P{constructor(t){super(t),this.events=new l.exports,this.on=(e,n)=>this.events.on(e,n),this.once=(e,n)=>this.events.once(e,n),this.off=(e,n)=>this.events.off(e,n),this.removeListener=(e,n)=>this.events.removeListener(e,n),this.pair=async e=>{try{return await this.engine.pair(e)}catch(n){throw this.logger.error(n.message),n}},this.approveSession=async e=>{try{return await this.engine.approveSession(e)}catch(n){throw this.logger.error(n.message),n}},this.rejectSession=async e=>{try{return await this.engine.rejectSession(e)}catch(n){throw this.logger.error(n.message),n}},this.updateSession=async e=>{try{return await this.engine.updateSession(e)}catch(n){throw this.logger.error(n.message),n}},this.extendSession=async e=>{try{return await this.engine.extendSession(e)}catch(n){throw this.logger.error(n.message),n}},this.respondSessionRequest=async e=>{try{return await this.engine.respondSessionRequest(e)}catch(n){throw this.logger.error(n.message),n}},this.disconnectSession=async e=>{try{return await this.engine.disconnectSession(e)}catch(n){throw this.logger.error(n.message),n}},this.emitSessionEvent=async e=>{try{return await this.engine.emitSessionEvent(e)}catch(n){throw this.logger.error(n.message),n}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(e){throw this.logger.error(e.message),e}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(e){throw this.logger.error(e.message),e}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}},this.respondAuthRequest=async(e,n)=>{try{return await this.engine.respondAuthRequest(e,n)}catch(i){throw this.logger.error(i.message),i}},this.getPendingAuthRequests=()=>{try{return this.engine.getPendingAuthRequests()}catch(e){throw this.logger.error(e.message),e}},this.formatMessage=(e,n)=>{try{return this.engine.formatMessage(e,n)}catch(i){throw this.logger.error(i.message),i}},this.metadata=t.metadata,this.name=t.name||p,this.core=t.core,this.logger=this.core.logger,this.engine=new U(this)}static async init(t){const e=new d(t);return await e.initialize(),e}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("Web3Wallet Initialization Success")}catch(t){throw this.logger.info("Web3Wallet Initialization Failure"),this.logger.error(t.message),t}}}const $=d;exports.CLIENT_CONTEXT=p,exports.CLIENT_STORAGE_OPTIONS=K,exports.CLIENT_STORAGE_PREFIX=X,exports.IWeb3Wallet=P,exports.IWeb3WalletEngine=T,exports.IWeb3WalletEvents=G,exports.PROTOCOL=b,exports.PROTOCOL_VERSION=z,exports.REQUEST_CONTEXT=k,exports.Web3Wallet=$,exports.default=d;
//# sourceMappingURL=index.cjs.js.map
